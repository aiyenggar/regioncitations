2019-01-11 Consolidated instructions (Windows and Mac)

Download http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_urban_areas_landscan.zip and from within it pulled out those with ne_10m_urban_areas_landscan and put them in ~/data/4.0.0-urban-areas

Open QGIS
Layer - Add Layer - Add Delimited Text Layer
~/processed/patents/locationid_spatialjoin.csv Let the X: Longitude and Y: Latitude be as default. Set CRS to WGS84 EPSG:4326
129759 lines in file including header
129758 lines loaded

Layer - Add Layer - Add Vector Layer and point it to ne_10m_urban_areas_landscan.shp for the Dataset and click Open. This has 6018 regions.
Delete all but three  fields: name_conve, max_pop_al, min_areakm. Save the file in the gis folder as date-urbanareas.shp. Now remove the ne_10m_urban_areas_landscan.shp and load date-urbanareas.shp which has only the three fields we are interested in.

Vector -> Data Management Tools -> Join Attributes by Location
Target vector layer : location
Join vector layer: ne_10m_urban_areas_landscan
Geometric Predicate (intersects)
Precision - Leave at 0
Attribute Summary - Take attributes of the first located feature
Statistics for summary - Delete all (and leave blank)
Joined table - Keep all records (including non-matching target records)
Output shapefile: /Users/aiyenggar/data/gis/20180528-4.0.0-ne_10m_urban_areas_landscan.shp

Started at 2019-01-13 22:13. Finished at 2019-01-13 23:08. This typically takes one hour.

Open the attribute table, select all. Now go back to the map, right click on the layer and save as -> Format: Comma Separated Value [CSV] and save as /Users/aiyenggar/processed/patents/locationid_urbanareas.csv














2018-08-25 Generating on the 20180528 version of patents data
I will use cle.location.tsv (128940) and cle.rawlocation.tsv (24991548)

Started at 3:30 AM following the instructions from 2018-03-20 (I've changed files names to reflect the above). Completed 4:12 AM.

2018-03-20 Trying to redo this entirely in Python. 
location.tsv has 133918 entries
rawlocation.tsv has 21334737 entries
ne_10m_urban_areas_landscan.shp has 6018 entries

I downloaded all the 10m resolution files, and from within it pulled out those with ne_10m_urban_areas_landscan and put them in ~/data/4.0.0-urban-areas

In QGIS - Create a Layer from a Delimited Text File, 
Layer - Add Layer - Add Delimited Text Layer
~/data/patentsview/location.tsv Let the X: Longitude and Y: Latitude be as default. Set CRS to WGS84 EPSG:4326 (was previously World Geodetic System 1984 IGNF:WBS84G)

Open ne_10m_urban_areas_landscan.shp in Qgis

Vector -> Data Management Tools -> Join Attributes by Location
Target vector layer : cle.location
Join vector layer: ne_10m_urban_areas_landscan
Geometric Predicate (intersects)
Precision - Leave at 0
Attribute Summary - Take attributes of the first located feature
Statistics for summary - Delete all (and leave blank)
Joined table - Keep all records (including non-matching target records)
Output shapefile: /Users/aiyenggar/data/gis/20180528-4.0.0-ne_10m_urban_areas_landscan.shp
This will take one hour, then say yes to if you would like to add the layer to TOC. Choose the CRS as above. I save this as locationid_urban_areas.

Open the attribute table, select all. Now go back to the map, right click on the layer and save as -> Format: Comma Separated Value [CSV] and save as ~/processed/patents/locationid_urbanareas.csv

Started 12:40 AM
Finished before 1:40 AM





Iteration 6, Dated 2017-06-08 (Using Urban Areas alone)
I take the natural earth urban centers data from http://www.naturalearthdata.com/downloads/10m-cultural-vectors/ with the specific link being
http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_urban_areas_landscan.zip

I copied all files to the parent folder ~/data/gis renamed all files as urban_areas. Then I opened urban_areas.shp in QGIS, deleted all but three  fields: name_conve, max_pop_al, min_areakm. Save the file as urban_areas.shp


In QGIS - Create a Layer from a Delimited Text File, 
Layer - Add Layer - Add Delimited Text Layer
~/data/patentsview/location.tsv Let the X: Longitude and Y: Latitude be as default. Set CRS to WGS84 EPSG:4326 (was previously World Geodetic System 1984 IGNF:WBS84G)

Open urban_areas.shp file

Vector -> Data Management Tools -> Join Attributes by Location
Target vector layer : location
Join vector layer: urban_areas
Geometric Predicate (intersects)
Precision - Leave at 0
Attribute Summary - Take attributes of the first located feature
Statistics for summary - Delete all (and leave blank)
Joined table - Keep all records (including non-matching target records)
Output shapefile: ~/data/gis/merged.shp
This will take a few (4) hours, then say yes to if you would like to add the layer to TOC. Choose the CRS as above. I save this as locationid_urban_areas.

Open the attribute table, select all. Now go back to the map, right click on the layer and save as -> Format: Comma Separated Value [CSV] and save as ~/data/patentsview/locationid_urban_areas.csv


