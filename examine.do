set more off
global destdir ~/processed/patents/

import delimited ${destdir}20190306-ua3-CalcDistTrue-ErrAss.csv, encoding(ISO-8859-1) clear
merge m:1 patent_id using ${destdir}application.dta, keep(match master) nogen
drop if patent_id=="NULL"
gen appl_date = date(date,"YMD")
gen year=year(appl_date)
keep year patent_id error num_lines
save ${destdir}20190306-ua3-CalcDistTrue-ErrAss.dta, replace 
count if missing(year) /* 2,625,274 missing year, in other words no info on patent */
tab year if !missing(year)

/* 
       year |      Freq.     Percent        Cum.
------------+-----------------------------------
        975 |          1        0.00        0.00
       1074 |          2        0.00        0.00
       1877 |          1        0.00        0.00
       1878 |          1        0.00        0.00
       1885 |          1        0.00        0.00
       1893 |          1        0.00        0.00
       1897 |          1        0.00        0.00
       1901 |          1        0.00        0.00
       1904 |          1        0.00        0.00
       1918 |          1        0.00        0.00
       1929 |          1        0.00        0.00
       1931 |          1        0.00        0.00
       1938 |          1        0.00        0.00
       1943 |          1        0.00        0.00
       1944 |          6        0.00        0.00
       1945 |          2        0.00        0.00
       1946 |          1        0.00        0.00
       1948 |          3        0.00        0.00
       1950 |          1        0.00        0.00
       1951 |          1        0.00        0.00
       1952 |          2        0.00        0.00
       1953 |          1        0.00        0.00
       1954 |          1        0.00        0.00
       1955 |          2        0.00        0.00
       1957 |          2        0.00        0.00
       1958 |          6        0.00        0.00
       1959 |          6        0.00        0.01
       1960 |          2        0.00        0.01
       1961 |          4        0.00        0.01
       1962 |         14        0.00        0.01
       1963 |          6        0.00        0.01
       1964 |          2        0.00        0.01
       1965 |         10        0.00        0.01
       1966 |          7        0.00        0.01
       1967 |         13        0.00        0.01
       1968 |         14        0.00        0.01
       1969 |         41        0.00        0.02
       1970 |         71        0.01        0.03
       1971 |        198        0.02        0.05
       1972 |        397        0.04        0.09
       1973 |      1,729        0.19        0.27
       1974 |      8,987        0.97        1.24
       1975 |     17,225        1.85        3.09
       1976 |     19,642        2.11        5.20
       1977 |     19,349        2.08        7.28
       1978 |     18,636        2.00        9.29
       1979 |     18,078        1.94       11.23
       1980 |     17,291        1.86       13.09
       1981 |     15,653        1.68       14.77
       1982 |     15,223        1.64       16.41
       1983 |     15,103        1.62       18.03
       1984 |     17,149        1.84       19.87
       1985 |     18,413        1.98       21.85
       1986 |     19,593        2.11       23.96
       1987 |     21,356        2.30       26.25
       1988 |     23,210        2.49       28.75
       1989 |     24,213        2.60       31.35
       1990 |     25,353        2.73       34.08
       1991 |     24,519        2.64       36.71
       1992 |     24,002        2.58       39.29
       1993 |     25,631        2.75       42.05
       1994 |     29,403        3.16       45.21
       1995 |     31,237        3.36       48.56
       1996 |     31,576        3.39       51.96
       1997 |     35,585        3.82       55.78
       1998 |     33,393        3.59       59.37
       1999 |     32,605        3.50       62.88
       2000 |     28,649        3.08       65.96
       2001 |     25,165        2.70       68.66
       2002 |     25,272        2.72       71.38
       2003 |     23,194        2.49       73.87
       2004 |     21,134        2.27       76.14
       2005 |     19,985        2.15       78.29
       2006 |     18,829        2.02       80.31
       2007 |     19,030        2.05       82.36
       2008 |     17,976        1.93       84.29
       2009 |     18,370        1.97       86.27
       2010 |     19,214        2.07       88.33
       2011 |     19,428        2.09       90.42
       2012 |     19,911        2.14       92.56
       2013 |     20,236        2.18       94.73
       2014 |     19,089        2.05       96.79
       2015 |     16,399        1.76       98.55
       2016 |     11,000        1.18       99.73
       2017 |      2,489        0.27      100.00
       2018 |          7        0.00      100.00
       2976 |          1        0.00      100.00
       9177 |          1        0.00      100.00
------------+-----------------------------------
      Total |    930,361      100.00
*/

tab error if missing(year)
/*
      error |      Freq.     Percent        Cum.
------------+-----------------------------------
         -3 |  2,625,270      100.00      100.00
         -2 |          4        0.00      100.00
------------+-----------------------------------
      Total |  2,625,274      100.00
*/

tab error if !missing(year)
/*
      error |      Freq.     Percent        Cum.
------------+-----------------------------------
         -3 |        271        0.03        0.03
         -2 |    930,090       99.97      100.00
------------+-----------------------------------
      Total |    930,361      100.00
*/

import delimited ${destdir}20190306-ua3-CalcDistTrue-ErrInv.csv, encoding(ISO-8859-1) clear
save ${destdir}20190306-ua3-CalcDistTrue-ErrInv.dta, replace 
